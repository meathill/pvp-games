# Copilot 指南（适用于 Gemini / Codex / GitHub Copilot CLI）

## 使用范围
- 供具备代码生成功能的助手直接消费，遵循相同约束；避免写入与架构不符的建议。
- 默认以 TypeScript 为优先语言，尽量采用平台支持的最新稳定特性（ES2022+、现代 Node/Web API）。

## 工作方式
1. **先设计再实现：** 先完善协议、状态机、时序草图，再写测试，最后编码；阶段性完成后立刻运行相关测试。
2. **保持最少文档但常更新：** 仅维护 README、TESTING、本文件为长期文档；短期规划放在 dev-note.md/WIP.md，长期想法放在 TODO.md，完成后要清理过时条目。
3. **小步提交并同步测试：** 分阶段提交；每次完成信令、协议或游戏逻辑的里程碑都要补齐测试与必要文档。

## 架构与代码约束
- **Shared 模块：** 定义协议类型、运行时模式校验、时钟同步与随机种子管理；测试应优先落在此处。
- **Server 模块：** 负责会话/房间管理、信令端点、TURN/STUN 配置分发及基础权限检查；尽量保持无状态或可水平扩展。
- **Games 模块（如 Snake）：** 客户端确定性模拟循环、输入对账与补偿；通过 WebRTC DataChannel 传输版本化 JSON 消息。
- **质量基线：** 避免在导入周围包裹 try/catch；保持类型安全、lint 通过；需要时加入延迟/丢包模拟以确保同步鲁棒性。

## 测试提醒
- 优先编写协议与确定性模拟的单元/契约测试，再实现功能。
- 完成每个阶段（信令、匹配、游戏规则、回滚）必须跑现有测试；重要合并前做 P2P 冒烟检查。

